<!DOCTYPE html>
<html>
  <head>
    <title>Best Text Editor</title>
  </head>
  <body>





    <script>
        var branches = [];

        var yes = "remove later";
        var no = "remove later";

        var family = {
            "message" : "That's great! A good family support network is really important! Would you like to talk about your family?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var school = {
            "message" : "Oh I'm glad it's going well! Do you want to talk about school?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
         };

        var university = {
            "message" : "I'm glad uni is going well. I hope youre not too stressed about exams?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }        
        };

        var friend = {
            "message" : "Thats good to hear! Friends are really important for your mental health! Would you like to talk about your friends?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var girlfriend = {
            "message" : "Oh wonderful! Would you like to talk about her?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var boyfriend = {
            "message" : "Oh wonderful! Would you like to talk about him?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var partner = {
           "message" : "Oh wonderful! Would you like to talk about them?",
           "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var holiday = {
            "message" : "Wow I'd love to go globetrotting like that! Did you have a good time?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var event = {
            "message" : "Sounds lovely! Did you have a good time?",
            "responseHandler" : responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

        var work = {
            "message" : "It's great that you love your job. Finding fulfilling work is hard but worth it! Would you like to talk about work?",
            "responseHandler" :responseHandlerYN1,
            "catch" : {
                "message" : "I'm sorry I didn't understand you there. Could you explain?",
                "responseHandler" : responseHandlerYN1
            }
        };

    var responseHandlerTopic = {
        "family" : family,
        "school" : school,
        "university" : university,
        "friend" : friend,
        "girlfriend" : girlfriend,
        "boyfriend" : boyfriend,
        "Wife" : girlfriend,
        "Husband" : boyfriend,
        "partner" : partner,
        "holiday" : holiday,
        "trip" : event,
        "event" : event,
        "wedding" : event,
        "party" : event,
        "night out" : event,
        "date" : event,
        "work" : work
    };

    var yesnoYN2 = {
        yes : {
            "message" : "Great, what would you like to talk about?",
            "responseHandler" : responseHandlerTopic,
            "catch" : {
                "message" : "Maybe we should talk about that in a later session. Is there anything else you want to speak about?",
                "responseHandler" : responseHandlerTopic
            }
        },

        no : {
            "message" : "Ok! I'm glad you stopped by, I'll see you soon for our next session."
        }
    };
    

    var responseHandlerYN2 = {
        "yes" : yesnoYN2.yes,
        "sure" : yesnoYN2.yes,
        "ok" : yesnoYN2.yes,
        "why not" : yesnoYN2.yes,
        "yeah" : yesnoYN2.yes,
        "no" : yesnoYN2.no,
        "nah" : yesnoYN2.no,
        "nope" : yesnoYN2.no
    };

    var yesnoYN1 = {
        yes : {
            "message" : "That's great, what would you like to tell me about?",
            "responseHandler" : {},
            "catch" : {
                "message" : "That sounds great! I'm glad everything's going well! is there anything else you'd like to talk about?",
                "responseHandler" : responseHandlerYN2,
                "catch" : {
                    "message" : "What do you want to talk about?",
                    "responseHandler" : responseHandlerTopic
                }
            }
        },
        no : {
            "message" : "That's ok, is there something else you'd like to talk about?",
            "responseHandler" : responseHandlerYN2
        }
    };

    var responseHandlerYN1 = {
        "yes" : yesnoYN1.yes,
        "sure" : yesnoYN1.yes,
        "ok" : yesnoYN1.yes,
        "why not" : yesnoYN1.yes,
        "yeah" : yesnoYN1.yes,
        "no" : yesnoYN1.no,
        "nah" : yesnoYN1.no,
        "nope" : yesnoYN1.no
    };

    var responseHandlerGood = {
        "family" : family,
        "school" : school,
        "university" : university,
        "friend" : friend,
        "girlfriend" : girlfriend,
        "boyfriend" : boyfriend,
        "Wife" : girlfriend,
        "Husband" : boyfriend,
        "partner" : partner,
        "holiday" : holiday,
        "trip" : event,
        "event" : event,
        "wedding" : event,
        "party" : event,
        "night out" : event,
        "date" : event,
        "work" : work

        };

    var good = {
        "message" : "Oh that's good! What's been making you so happy?",
        "responseHandler" : responseHandlerGood,
        "catch" : {
            "message" : "That sounds nice, I'm glad you're feeling good about life right now. Is there anything else you'd like to talk to me about?",
            "responseHandler" : responseHandlerYN2
        }
    };


    var bad = {
        "message" : "Awh no :c"
    };

    var cake = {
        "message" : "CAKE!"
    };

    var allThings = {
        "message" : "Hello, we're going to have a 'therapy session'. How are you today?",
        "responseHandler" : responseHandler1,
        "catch" : "Sorry, I didn't understand that, could you explain?"
    };

    var responseHandler1 = {
        "good"  : good,
        "great" : good,
        "awesome" : good,
        "bad"   : bad,
        "shitty" : bad,
        "shit" : bad,
        "awful" : bad,
        "terrible" : bad,
        "cake"  : cake
    };

    var position = allThings;


    function makeBranch(question, responseHandler){
        var branch = {
            question : question,
            responseHandler : responseHandler
        };

        branch.question.responseHandler = branch.responseHandler;

        return branch;
    }

    function secureLink(responseHandler, question){

    }



    makeBranch(allThings, responseHandler1);
    makeBranch(good, responseHandlerGood);
    makeBranch(work, responseHandlerYN1);
    makeBranch(school, responseHandlerYN1);
    makeBranch(family, responseHandlerYN1);
    makeBranch(friend, responseHandlerYN1);
    makeBranch(girlfriend, responseHandlerYN1);
    makeBranch(boyfriend, responseHandlerYN1);
    makeBranch(partner, responseHandlerYN1);
    makeBranch(holiday, responseHandlerYN1);
    makeBranch(event, responseHandlerYN1);


    //process a command
    function processCommand(command){
        
        var thecatch = position.catch;
        var oldposition = position;

        //Clear this later

        position =  position.responseHandler[command];

        if (position == undefined) {
            console.log("WARN: Does the response handler have a corresponding command? It's not here");
            if (typeof thecatch == "string") {
                position = oldposition;
                return thecatch;
            }else{
                if (thecatch == undefined) {
                    thecatch = allThings;
                    //HERE!
                }
                position = thecatch;
            }
        }

        var tempResponse = position.message;

        if (position.responseHandler == undefined) {
            
            console.log("ERROR: Does the response to this keyword have a corresponding response handler?");

            //return "Oh No";
        }
        return tempResponse;
    }




    //Document Editing Sheit

    var response = allThings.message + "<br/>";
    var message = "";

    function addText() {
      var command = document.getElementById("command").value;
      //processCommand(command);
      response+= processCommand(command);
      response+= "<br/>";


      document.getElementById("console").innerHTML=response;
      document.getElementById("command").value="";

      return false;
    }

    </script>

    <div id="console">
    </div>
    <form onsubmit="return addText()">
      <input id="command" type="text" name="text" autocomplete="off"/>
    </form>

    <script>

    document.getElementById("console").innerHTML=response;

    </script>





  </body>
</html>